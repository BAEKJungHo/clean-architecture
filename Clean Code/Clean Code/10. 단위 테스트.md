# 단위 테스트

## TDD 법칙 세 가지

1. 실패하는 단위 테스트를 작성할 때까지 실제 코드를 작성하지 않는다.
2. 컴파일은 실패하지 않으면서 실행이 실패하는 정도로만 단위 테스트를 작성한다.
3. 현재 실패하는 테스트를 통과할 정도로만 실제 코드를 작성한다.

위 세 가지 규칙을 따르면 개발과 테스트가 대략 30초 주기로 묶인다. 테스트 코드와 실제 코드가 함께 나올뿐더러 테스트 코드가 실제 코드보다 불과 몇 초 전에 나온다.

## 깨끗한 테스트 코드 유지하기

테스트 코드가 지저분하면, 안짜는 것보다 못하다. 

__실제 코드가 변하면 테스트 코드도 변해야 한다.__ 따라서 테스트 코드가 지저분할 수록 변경하기 어려워진다. 새 버전을 출시할 때마다 팀이 테스트 케이스를 유지하고 보수하는 비용도 늘어난다.
따라서 테스트 슈트를 폐기하게되는데, 테스트 슈트가 없으면 이쪽을 수정해도 반대편이 안전하다는 사실을 보장하지 못하고 결함률이 높아진다.

__즉, 테스트 코드는 실제 코드 못지 않게 중요하다.__

### 테스트는 유연성, 유지보수성, 재사용성을 제공한다.

코드에 유연성, 유지보수성, 재사용성을 제공하는 버팀목이 바로 __단위 테스트__ 이다. 이유는 단순하다. 테스트 코드가 있으면 변경이 두렵지 않기 때문이다.
즉, 테스트 코드가 있다면 `변경`이 쉬워진다.

## 깨끗한 테스트 코드

깨끗한 테스트 코드를 만들기 위해서는 `가독성`이 좋아야 한다. 책의 저자는 실제 코드보다 테스트 코드에서의 가독성이 더 중요할 수도 있다고 말하고 있다.

`BUILD-OPERATE-CHECK` 패턴은 가독성을 늘리기에 좋다.
 
- `BUILD` : 테스트 자료를 만든다.
- `OPERATE` : 테스트 자료를 조작한다.
- `CHECK` : 조작한 결과를 확인한다.

`given-when-then` 을 관례적으로 주석으로 사용한다.

### 도메인에 특화된 테스트 언어

### 이중 표준

테스트 코드에 적용하는 표준은 실제 코드에 적용하는 표준과 확실히 다르다. 가독성이 좋고, 간결하고, 표현이 풍부해야 하지만, 실제 코드만큼 효율적일 필요는 없다.

> 이중 표준이라는 말은 원래 코드와 테스트 코드의 표준은 즉 구현 방식은 다르다는 것이다.

## 테스트당 assert 하나

JUnit 으로 테스트 코드를 짤 때는 함수마다 assert 문을 단 하나만 사용해야 한다고 주장하는 학파가 있다.(Dave Astel)

가혹하지만 확실히 장점이 있다.

- 결론이 하나라서 이해하기 쉽고 빠르다.

단점은 테스트를 분리하게 되면 중복되는 코드가 많아진다.

`Template method` 패턴을 사용하여 중복을 제거할 수 있다. given/when 을 부모 클래스에 두고 then 부분을 자식 클래스에 둔다. 아니면 오나전히 독자적인 테스트 클래스를 만들어
@Before 에 given/when 을 두고 @Test 에 then 을 넣어도 된다.

하지만 여러가지를 감안했을때 assert 문을 하나의 함수에 넣었을때 더 좋은 경우가 있다.

__최대한 assert 문을 줄이는 게 좋다.__

### 테스트당 개념 하나

__테스트 함수마다 한 개념만 테스트하라__

## F.I.R.S.T

깨끗한 테스트는 다음 다섯 가지 규칙을 따른다.

- `빠르게(Fast)`
  - 테스트는 빨라야 한다.
  - 테스트가 느리게 돌아가면 자주 돌릴 엄두를 못 낸다.
- `독립적으로(Independent)`
  - 각 테스트는 서로 의존하면 안 된다.
  - 한 테스트가 다음 테스트가 실행될 환경을 준비해서는 안 된다.
  - 각 테스트는 독립적으로 그리고 어떤 순서로 실행해도 괜찮아야 한다.
- `반복가능하게(Repeatable)`
  - 테스트는 어떤 환경에서도 반복 가능해야 한다.
- `자가검증하는(Self-Validating)`
  - 테스트는 부울(bool) 값으로 결과를 내야 한다. 즉, 성공 아니면 실패다.
  - 통과 여부를 알려고 로그 파일을 읽게 만들어서는 안 된다.
- `적시에(Timely)`
  - 테스트는 적시에 작성해야 한다.
  - 단위 테스트는 테스트하려는 실제 코드를 구현하기 직전에 구현한다.

## 정리

테스트 코드는 실제 코드만큼이나 프로젝트 건강에 중요하다. 어쩌면 실제 코드보다 더 중요할지도 모른다. 테스트 코드는 실제 코드의 유연성, 유지보수성, 재사용성을 보존하고 강화하기 때문이다.
그러므로 테스트 코드는 지속적으로 깨끗하게 관리하고, 표현력을 높이고 간결하게 정리하자. 테스트 API 를 구현해 도메인 특화 언어(DSL, Domain Specific Language)를 만들자. 그러면 그 만큼
테스트 코드를 작성하기가 쉬워진다.

# 함수

## 작게 만들어라 !

함수를 만드는 첫 번째 규칙은 `작게 만드는 것`이다. 함수를 만드는 두 번째 규칙은 `더 작게 만드는 것`이다. 이 규칙은 근거를 대기가 곤란하다. 증거나 자료를 제시하기도 어렵낟.
책의 저자는 오랜 시행착오를 바탕으로 작은 함수가 좋다고 확신한다.

함수는 얼마나 짧아야 할까 ? 2-5 줄 사이면 적당하다.

```java
public static String renderPageWithSetupsAndTeardowns(
  PageData pageData,
  boolean isSuite
) throws Exception {
  includeSetupAndTeardownPages(pageData, isSuite);
  return pageData.getHtml();
}
```

다시 말해, if/else/while 문 등에 들어가는 블록은 한 줄이어야 한다는 의미이다. 대게 거기서 함수를 호출한다. 그러면 바깥을 감싸는 함수(enclosing function)가 작아질 뿐만 아니라,
블록 안에서 호출하는 함수 이름을 적절히 짓는다면, 코드를 이해하기도 쉬워진다.

## 한 가지만 해라!

__함수는 한 가지를 해야 한다. 그 한 가지를 잘 해야 한다. 그 한 가지만을 해야 한다.__

지정된 함수 이름 아래에서 추상화 수준이 하나인 단계만 수행한다면 그 함수는 한 가지 작업만 한다. __즉, 함수의 이름과 추상화 수준이 같아야 한다.__

## 함수 당 추상화 수준은 하나로 !

함수가 확실히 한 가지 작업만 하려면 함수 내 모든 문장의 추상화 수준이 동일해야 한다.

### 위에서 아래로 코드 읽기 : 내려가기 규칙

코드는 위에서 아래로 이야기 처럼 읽혀야 좋다. 

Ex. public 메서드를 위에 배치하고, private 메서드를 아래로 배치하는게 좋다.

__신문기사 배치 방식__ 이라고도 부른다.

## switch 문

switch 문을 작게 만들기는 어렵다.

- 직원 유형에 따라 다른 값을 계산에 반환하는 함수

```java
public Money calculatePay(Employee e) throws InvalidEmployeeType {
  switch(e.type) {
    case COMMISSIONED:
      return calculateCommissionedPay(e);
    case HOURLY:
      return calculateHourlyPay(e);
    case SALARIED:
      return calculateSalariedPay(e);
    default:
      throw new InvalidEmployeeType(e.type);
  }
}
```

위 함수에는 몇 가지 문제가 있다.

1. 함수가 길다. 새 직원 유형을 추가하면 더 길어진다.
2. 한 가지 작업만 하지 않는다.
3. SRP 를 위반한다. 코드를 변경할 이유가 여럿이기 때문이다.
4. OCP 를 위반한다. 새 직원 유형을 추가할 때마다 코드를 변경하기 때문이다.
5. 위 함수와 구조가 동일한 함수가 무한정 존재한다는 사실이다.

- 해결 : switch 문을 ABSTRACT FACTORY 에 꽁꽁 숨긴다.

```java
public abstract class Employee {
  public abstract boolean isPayday();
  public abstract Money calculatePay();
  public abstract void deliverPay(Money pay);
}

public interface EmployeeFactory {
  public Employee makeEmployee(EmployeeRecord r) throws InvalidEmployeeType;
}

public class EmployeeFactoryImpl implements EmployeeFactory {
  public Employee makeEmployee(EmployeeRecord r) throws InvalidEmployeeType {
    switch(r.type) {
      case COMMISSIONED:
        return new CommissionedEmployee(r);
        
      // 생략
    }
  }

}
```
